<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.20/css/dataTables.bootstrap4.min.css">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js"></script>

    <script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.3.0/firebase-firestore.js"></script>
    <script src="database.js"></script>

    <!--<link rel="stylesheet" href="leaderboard.css">-->
    <style>
        body {
            min-width: 80%;
        }

        #table-div {
            text-align: center;
            min-width: 100%;
        }

        table {
            color: white;
            border-spacing: 0;
        }

        tr:first-child {
            color: gold;
            background-color: white;
            border: none;
        }

        tr:first-child>td {
            border: none;
        }

        tr:nth-child(2)>td {
            border-top-width: 2;
        }

        tr {
            font-size: 22px;
            font-weight: bold;
            background-color: #484848;
        }

        th,
        td {
            margin: 0;
            padding: .5em 0.5em;
            text-align: center;
            border-width: 1px 0;
            border-color: gray;
            border-style: solid;
        }

        th {
            background-color: white;
            color: black;
            font-weight: bolder;
            font-size: 35px;
            border-width: 2px;
        }

        td:nth-child(odd) {
            border-width: 1px 4px;
            border-color: gray;
            border-style: solid;
        }
    </style>
</head>

<body>
    <div id='table-div'>
        <table id='results'>
        </table>
    </div>

    <script>

        var db = initFirestore();
        var leaderData;
        fetchLeaderboard(db).then( ([err,res]) => {
            if( !err ){
                populateTable(res);
            }
        });
        
        //dataSet.sort((a, b) => a.score < b.score);
        
        //console.log(dataSet);
        function populateTable(leaderData) {
            console.log(leaderData);
            for (const [i, o] of leaderData.entries()) { o.rank = i + 1 };
            let table = $('#results').DataTable({
                dom: 't',
                data: leaderData,
                autoWidth: true,
                pageLength: 25,
                columns: [
                    { title: 'RANK', data: 'rank', width: '33%' },
                    { title: 'USER', data: 'name', width: '33%' },
                    { title: 'SCORE', data: 'score', width: '33%' }
                ]
            });
        }

    </script>

</body>

</html>